<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.moyeo.mapper.PackageMapper">

	<!-- 관리자  -->
	
	<!-- 패키지 등록 -->
   <insert id="insertPackage">
      <selectKey resultType="int" keyProperty="packIdx" order="BEFORE">
         SELECT pack_seq.nextval 
         FROM DUAL
      </selectKey>
	      INSERT INTO 
	      pack (
	         pack_idx
	         , pack_kind
	         , pack_title
	         , pack_startdate
	         , pack_enddate
	         , pack_regdate
	         , pack_people
	         , pack_childprice
	         , pack_adultprice
	         , pack_previewimg
	         , pack_slideimg1
	         , pack_slideimg2
	         , pack_slideimg3
	         , pack_contentimg1
	         , pack_contentimg2
	         , pack_contentimg3
	         , pack_calendarimg
	         , pack_status
	      ) 
	      VALUES (
	         #{packIdx}
	         , #{packKind}
	         , #{packTitle}
	         , TO_DATE(#{packStartDate}, 'YYYY-MM-DD')
	         , TO_DATE(#{packEndDate}, 'YYYY-MM-DD')   
	         , sysdate
	         , #{packPeople}
	         , #{packChildPrice}
	         , #{packAdultPrice}
	         , #{packPreviewImg}
	         , #{packSlideImg1}
	         , #{packSlideImg2}
	         , #{packSlideImg3}
	         , #{packContentImg1}
	         , #{packContentImg2}
	         , #{packContentImg3}
	         , #{packCalendarImg}
	         , #{packStatus}
	      )
   </insert> 
	

	<!-- 모든 접속자 -->  

	 <!-- 패키지 상품 정보 출력 (상세페이지) -->
   <select id="selectPackInfo" resultType="Pack">
      SELECT 
         pack_idx
         , pack_kind
         , pack_title
         , TO_CHAR(pack_startdate,'yyyy-mm-dd') as pack_startdate
         , TO_CHAR(pack_enddate,'yyyy-mm-dd') as pack_enddate
         , pack_regdate
         , pack_people
         , pack_childprice
         , pack_adultprice
         , pack_heart
         , pack_previewimg
         , pack_slideimg1
         , pack_slideimg2
         , pack_slideimg3
         , pack_contentimg1
         , pack_contentimg2
         , pack_contentimg3
         , pack_calendarimg
         , pack_status
      FROM pack
      WHERE pack_idx=#{packIdx}
   </select>


	<!-- 패키지 변경 -->
   <update id="updatePack">
      UPDATE pack
      <set>
         <if test="packKind != null and packKind != ''">
            pack_kind=#{packKind},
         </if>
         <if test="packTitle != null and packTitle != ''">
            pack_title=#{packTitle},
         </if>
         <if test="packStartDate != null and packStartDate != ''">
            pack_startdate = TO_DATE(#{packStartDate}, 'YYYY-MM-DD'),
         </if>
         <if test="packEndDate != null and packEndDate != ''">
            pack_enddate = TO_DATE(#{packEndDate}, 'YYYY-MM-DD'),
         </if>
         <if test="packRegDate != null and packRegDate != ''">
            pack_regdate=#{packRegDate},
         </if>
         <if test="packPeople != null and packPeople != ''">
            pack_people=#{packPeople},
         </if>
         <if test="packChildPrice != null and packChildPrice != ''">
            pack_childprice=#{packChildPrice},
         </if>
         <if test="packAdultPrice != null and packAdultPrice != ''">
            pack_adultprice=#{packAdultPrice},
         </if>
         <if test="packPreviewImg != null and  packPreviewImg != ''">
             pack_previewimg=#{packPreviewImg},
         </if>
         <if test="packSlideImg1 != null and packSlideImg1 != ''">
            pack_slideimg1=#{packSlideImg1},
         </if>
         <if test="packSlideImg2  != null and packSlideImg2  != ''">
            pack_slideimg2=#{packSlideImg2},
         </if>
         <if test="packSlideImg3 != null and packSlideImg3 != ''">
            pack_slideimg3=#{packSlideImg3},
         </if>
         <if test="packContentImg1 != null and packContentImg1 != ''">
            pack_contentimg1=#{packContentImg1},
         </if>
         <if test="packContentImg2 != null and packContentImg2 != ''">
            pack_contentimg2=#{packContentImg2},
         </if>
         <if test="packContentImg3 != null and packContentImg3 != ''">
            pack_contentimg3=#{packContentImg3},
         </if>
         <if test="packCalendarImg != null and packCalendarImg != ''">
            pack_calendarimg=#{packCalendarImg},
         </if>
         <if test="packStatus == 0 or packStatus == 1">
            pack_status=#{packStatus}
         </if>
      </set>
      WHERE pack_idx=#{packIdx}
   </update>
	
	<!-- 패키지 삭제 -->
	<delete id="deletePack">
		DELETE FROM pack WHERE pack_idx=#{packIdx}
	</delete>

	<!-- 패키지 제목으로 패키지 검색 -->
	<select id="selectPackByName" resultType="Pack">
		SELECT 
			 pack_idx
	        , pack_kind
	        , pack_title
	        , TO_CHAR(pack_startdate,'yyyy-mm-dd') as pack_startdate
	        , TO_CHAR(pack_enddate,'yyyy-mm-dd') as pack_enddate
	        , pack_regdate
	        , pack_people
	        , pack_childprice
	        , pack_adultprice
	        , pack_heart
	        , pack_previewimg
	        , pack_slideimg1
	        , pack_slideimg2
	        , pack_slideimg3
	        , pack_contentimg1
	        , pack_contentimg2
	        , pack_contentimg3
	        , pack_calendarimg
	        , pack_status
		FROM pack 
		WHERE pack_name LIKE '%' || #{keyword} || '%'
	</select>
	
	<!-- 패키지 전체 목록 검색  -->
	<select id="selectPackList" resultType="Pack">
		SELECT 
			pack_idx
	        , pack_kind
	        , pack_title
	        , TO_CHAR(pack_startdate,'yyyy-mm-dd') as pack_startdate
	        , TO_CHAR(pack_enddate,'yyyy-mm-dd') as pack_enddate
	        , pack_regdate
	        , pack_people
	        , pack_childprice
	        , pack_adultprice
	        , pack_heart
	        , pack_previewimg
	        , pack_slideimg1
	        , pack_slideimg2
	        , pack_slideimg3
	        , pack_contentimg1
	        , pack_contentimg2
	        , pack_contentimg3
	        , pack_calendarimg
	        , pack_status
		FROM pack 
		ORDER BY pack_idx
	</select>
	
</mapper>